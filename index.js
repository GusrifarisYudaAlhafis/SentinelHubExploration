import axios from 'axios';
import qs from 'qs';

async function getToken() {
  let client_id = ''
  let client_secret = ''
  const instance = axios.create({
    baseURL: "https://services.sentinel-hub.com"
  })

  const config = {
    headers: {
      "Content-Type": "application/x-www-form-urlencoded;charset=utf-8"
    }
  }

  const body = qs.stringify({
    client_id,
    client_secret,
    grant_type: "client_credentials"
  })

  let token;

  // All requests using this instance will have an access token automatically added
  await instance.post("/oauth/token", body, config).then((resp) => {
    token = resp.data.access_token
  })
  return token
}

const token = await getToken();
const instanceID = ''

const evalscript = `
// VERSION=3
// QuickFire V1.0.0 by Pierre Markuse (https://twitter.com/Pierre_Markuse)
// Made for use in the Sentinel Hub EO Browser (https://apps.sentinel-hub.com/eo-browser/?)
// CC BY 4.0 International (https://creativecommons.org/licenses/by/4.0/)

function setup() {
  return {
    input: ["B01","B02","B03","B04","B08","B8A","B11","B12","CLP", "dataMask"],
    output: { bands: 4 }
  };
}

function stretch(val, min, max) {return (val - min) / (max - min);}

function satEnh(arr, s) {
   var avg = arr.reduce((a, b) => a + b, 0) / arr.length;
   return arr.map(a => avg * (1 - s) + a * s);
}

 function layerBlend(lay1, lay2, lay3, op1, op2, op3) {
    return lay1.map(function(num, index) {
     return (num / 100 * op1 + (lay2[index] / 100 * op2) + (lay3[index] / 100 * op3));
    });
  }

function evaluatePixel(sample) {
  const hsThreshold = [2.0, 1.5, 1.25, 1.0];
  const hotspot = 1;
  const style = 1;
  const hsSensitivity = 1.0;
  const boost = 1;

  const cloudAvoidance = 1;
  const cloudAvoidanceThreshold = 245;
  const avoidanceHelper = 0.8;

  const offset = -0.000;
  const saturation = 1.10;
  const brightness = 1.00;
  const sMin = 0.01;
  const sMax = 0.99;

  const showBurnscars = 0;
  const burnscarThreshold = -0.25;
  const burnscarStrength = 0.3;

  const NDWI = (sample.B03-sample.B08)/(sample.B03+sample.B08);
  const NDVI = (sample.B08-sample.B04)/(sample.B08+sample.B04);
  const waterHighlight = 0;
  const waterBoost = 2.0;
  const NDVI_threshold = -0.15;
  const NDWI_threshold = 0.15;
  const waterHelper = 0.2;

  const Black = [0, 0, 0];
  const NBRindex = (sample.B08-sample.B12) / (sample.B08+sample.B12);
  const naturalColorsCC = [Math.sqrt(brightness * sample.B04 + offset), Math.sqrt(brightness * sample.B03 + offset), Math.sqrt(brightness * sample.B02 + offset)];
  const naturalColors = [(2.5 * brightness * sample.B04 + offset), (2.5 * brightness * sample.B03 + offset), (2.5 * brightness * sample.B02 + offset)];
  const URBAN = [Math.sqrt(brightness * sample.B12 * 1.2 + offset), Math.sqrt(brightness * sample.B11 * 1.4 + offset), Math.sqrt(brightness * sample.B04 + offset)];
  const SWIR = [Math.sqrt(brightness * sample.B12 + offset), Math.sqrt(brightness * sample.B8A + offset), Math.sqrt(brightness * sample.B04 + offset)];
  const NIRblue = colorBlend(sample.B08, [0, 0.25, 1], [[0/255, 0/255, 0/255],[0/255, 100/255, 175/255],[150/255, 230/255, 255/255]]);
  const classicFalse = [sample.B08 * brightness, sample.B04 * brightness, sample.B03 * brightness];
  const NIR = [sample.B08 * brightness, sample.B08 * brightness, sample.B08 * brightness];
  const atmoPen = [sample.B12 * brightness, sample.B11 * brightness, sample.B08 * brightness];
  var enhNaturalColors = [0, 0, 0];
  for (let i = 0; i < 3; i += 1) { enhNaturalColors[i] = (brightness * ((naturalColors[i] + naturalColorsCC[i]) / 2) + (URBAN[i] / 10)); }

  const manualCorrection = [0.00, 0.00, 0.00];

  var Viz = layerBlend(URBAN, naturalColors, naturalColorsCC, 10, 40, 50); // Choose visualization(s) and opacity here

  if (waterHighlight) {
    if ((NDVI < NDVI_threshold) && (NDWI > NDWI_threshold) && (sample.B04 < waterHelper)) {
     Viz[1] = Viz[1] * 1.2 * waterBoost + 0.1;
     Viz[2] = Viz[2] * 1.5 * waterBoost + 0.2;
    }
  }

  Viz = satEnh(Viz, saturation);
  for (let i = 0; i < 3; i += 1) {
    Viz[i] = stretch(Viz[i], sMin, sMax);
    Viz[i] += manualCorrection[i];
  }

  if (hotspot) {
    if ((!cloudAvoidance) || ((sample.CLP<cloudAvoidanceThreshold) && (sample.B02<avoidanceHelper))) {
     switch (style) {
       case 1:
        if ((sample.B12 + sample.B11) > (hsThreshold[0] / hsSensitivity)) return [((boost * 0.50 * sample.B12)+Viz[0]), ((boost * 0.50 * sample.B11)+Viz[1]), Viz[2], sample.dataMask];
        if ((sample.B12 + sample.B11) > (hsThreshold[1] / hsSensitivity)) return [((boost * 0.50 * sample.B12)+Viz[0]), ((boost * 0.20 * sample.B11)+Viz[1]), Viz[2], sample.dataMask];
        if ((sample.B12 + sample.B11) > (hsThreshold[2] / hsSensitivity)) return [((boost * 0.50 * sample.B12)+Viz[0]), ((boost * 0.10 * sample.B11)+Viz[1]), Viz[2], sample.dataMask];
        if ((sample.B12 + sample.B11) > (hsThreshold[3] / hsSensitivity)) return [((boost * 0.50 * sample.B12)+Viz[0]), ((boost * 0.00 * sample.B11)+Viz[1]), Viz[2], sample.dataMask];
       break;
       case 2:
        if ((sample.B12 + sample.B11) > (hsThreshold[3] / hsSensitivity)) return [1, 0, 0, sample.dataMask];
       break;
       case 3:
        if ((sample.B12 + sample.B11) > (hsThreshold[3] / hsSensitivity)) return [1, 1, 0, sample.dataMask];
       break;
       case 4:
        if ((sample.B12 + sample.B11) > (hsThreshold[3] / hsSensitivity)) return [Viz[0] + 0.2, Viz[1] - 0.2, Viz[2] - 0.2, sample.dataMask];
       break;
       default:
      }
    }
  }

  if (showBurnscars) {
   if (NBRindex<burnscarThreshold) {
     Viz[0] = Viz[0] + burnscarStrength;
     Viz[1] = Viz[1] + burnscarStrength;
   }
  }

  return [Viz[0], Viz[1], Viz[2], sample.dataMask];
}`

// console.log(evalscript);

let coordinatesBBOX = {
  "bbox": [
    13.822174072265625,
    45.85080395917834,
    14.55963134765625,
    46.29191774991382
  ]
}

let coordinatesPolygon = {
  "geometry": {
    "type": "Polygon",
    "coordinates": [[[101.15522239165165, 0.6775597050092862], [101.15447381616937, 0.6792616593255287], [101.15391701940132, 0.6793161544832909], [101.15390899336658, 0.6811491659359503], [101.15386667701047, 0.6811477330189921], [101.15261771797039, 0.6811266185979287], [101.15260709745047, 0.6811255077311943], [101.15259682727549, 0.6811225677377587], [101.15258721463522, 0.681117887984079], [101.15257854877986, 0.6811116084736282], [101.15257109024174, 0.6811039171393691], [101.15256506185227, 0.6810950453275355], [101.15256064514554, 0.6810852587582197], [101.15255797227297, 0.6810748521045403], [101.15255712420236, 0.6810641381444168], [101.15255827118061, 0.6809044956572113], [101.15256196917788, 0.6806789431369946], [101.15257323053703, 0.680365247724481], [101.152582609188, 0.6800791233112624], [101.15258261885913, 0.6800786540854755], [101.15258440554128, 0.6798220632949907], [101.15258045794839, 0.6794945928068781], [101.15257558872675, 0.6792193157040117], [101.15258115976185, 0.6789334470529292], [101.15258384617863, 0.6785582730249786], [101.15258746727633, 0.6781478020975208], [101.15259196926566, 0.6776045718505144], [101.15259568304094, 0.6775784402506255], [101.15259696837273, 0.677572683350141], [101.1525991375558, 0.677567202704948], [101.1526021349675, 0.677562133049009], [101.15260588791774, 0.6775576009870954], [101.15261030125751, 0.6775537186686317], [101.15261526636041, 0.6775505846877787], [101.15262066022042, 0.6775482750429285], [101.15262634635211, 0.6775468476567134], [101.1526321855661, 0.6775463387549275], [101.152856114982, 0.6775446681518236], [101.15314119335403, 0.6775474101437932], [101.15369058369347, 0.6775519486547733], [101.15369067619758, 0.6775519486133613], [101.15427137058975, 0.677550732090745], [101.1547247063087, 0.6775553125870399], [101.15522239165165, 0.6775597050092862]]]
  }
}

let coordinatesMultiPolygon = {
  "geometry": {
    "type": "MultiPolygon",
    "coordinates": [[[[101.1282210603695, 0.6434409744554949], [101.12823164377768, 0.6437877817692598], [101.12820157326463, 0.6441490663847113], [101.12819475669961, 0.6441622167046894], [101.12819462568515, 0.6441624798535011], [101.12819430986102, 0.6441632258705802], [101.12819406140542, 0.6441639971741929], [101.12819388211231, 0.6441647883389645], [101.12819379882323, 0.6441653543419243], [101.12813084843197, 0.6447098519345064], [101.12813017445268, 0.6447132163823427], [101.12812895615434, 0.6447164219373196], [101.12812722673007, 0.6447193799834716], [101.1281250346439, 0.6447220091311756], [101.12812244003858, 0.6447242361228461], [101.1281195147375, 0.644726000353424], [101.12811634044745, 0.6447272511587772], [101.12811300337313, 0.6447279559549429], [101.12796514574856, 0.6447464501232852], [101.12780870735793, 0.6447579004246018], [101.12739535698026, 0.6446845925397856], [101.12739500040826, 0.6446845366354498], [101.12739419836811, 0.6446844646447129], [101.12739398192116, 0.6446844575029596], [101.12693678809993, 0.644675080826069], [101.12693653752707, 0.6446750791232561], [101.12640140770854, 0.6446791321769141], [101.12640122269937, 0.6446791349670263], [101.12564667933034, 0.6447004988692793], [101.12481903355469, 0.6446970205949082], [101.12380303433316, 0.6446706588516335], [101.12380284483051, 0.6446706553148026], [101.12321068108508, 0.6446678743561327], [101.12321053828559, 0.6446678744160972], [101.12258497225852, 0.6446749142395588], [101.12216418211865, 0.6446703099593437], [101.1218392887964, 0.6446532321356383], [101.12183921964073, 0.644653229452329], [101.12183872118544, 0.6446532206204401], [101.12139309484498, 0.644658190324519], [101.12073264576793, 0.6446422043074377], [101.12073224071962, 0.6446422044773202], [101.1203190114307, 0.644650983966446], [101.11999227038588, 0.6446406034942362], [101.11999164530069, 0.6446406055645236], [101.11966402005767, 0.6446531707726829], [101.11924886286005, 0.6446417550404347], [101.11924556124215, 0.6446413776032092], [101.11924237165685, 0.6446404404765365], [101.11923938662059, 0.6446389698407758], [101.11923669506442, 0.644637009055785], [101.11923437424956, 0.6446346150479526], [101.11923249156362, 0.6446318583094288], [101.11923110362096, 0.6446288192820444], [101.11923024997519, 0.6446255865517347], [101.11922995581268, 0.6446222550392154], [101.11922915977476, 0.6443630269850152], [101.11924421891642, 0.6440273843662286], [101.11924422777764, 0.644027094144031], [101.1192488318864, 0.6436692754400641], [101.11925238746444, 0.6435125496474502], [101.11925239007181, 0.6435123389893403], [101.11925237730489, 0.6435118706670551], [101.11925172005387, 0.6434992233836736], [101.11925169566413, 0.643498882545379], [101.11925158755847, 0.6434980779350282], [101.11925154885678, 0.6434978772393822], [101.11924901734537, 0.643485472136803], [101.11924887609838, 0.6434848827178637], [101.11924864768227, 0.6434841667603702], [101.1192443004031, 0.6434722831832371], [101.11924427972338, 0.643472227137224], [101.11924396238186, 0.6434714813813849], [101.11924374036936, 0.6434710484068151], [101.11923767442897, 0.6434599539302657], [101.11923751444894, 0.6434596728197964], [101.11923707050197, 0.6434589958290632], [101.11923693750745, 0.6434588168714359], [101.11922929042042, 0.6434487618756529], [101.11922892021008, 0.6434483063603915], [101.11922839278793, 0.6434477487467488], [101.1192193209134, 0.6434389456315328], [101.11921869919321, 0.6434383970984224], [101.11921829761164, 0.6434380934863186], [101.11920803545017, 0.6434307681804209], [101.11920778480558, 0.643430595600744], [101.11920747128194, 0.6434303959241608], [101.11915677812534, 0.6433996901341841], [101.11913951846319, 0.6433872694925754], [101.11912466657829, 0.6433725224791201], [101.11911230426433, 0.6433556072784227], [101.11910273884973, 0.6433369450760892], [101.11909620673023, 0.6433170013886942], [101.11909287246493, 0.6432962715984348], [101.11909281694884, 0.6432749129862998], [101.11910316093133, 0.6431388124567446], [101.11910318583938, 0.6431382329134236], [101.11910778117732, 0.6427564481008797], [101.11910778202287, 0.642756320621369], [101.11910670523108, 0.6424492472931576], [101.11910949887721, 0.642273969520924], [101.1191119274413, 0.6422370800175006], [101.11911797476901, 0.6422008426730414], [101.11912765429943, 0.64216517882482], [101.11915173277082, 0.6420912561793696], [101.11915179286537, 0.6420910644834912], [101.11924452110371, 0.6417834764621575], [101.11926151417255, 0.6417308593622497], [101.11926163166329, 0.6417304660265066], [101.1192616621522, 0.6417303520962622], [101.1192739943474, 0.641682891258189], [101.11927414315518, 0.6416822140196776], [101.11927420048622, 0.6416818541610066], [101.11928094416683, 0.6416332691372464], [101.1192809951761, 0.6416328242951315], [101.1192810290535, 0.6416322149126129], [101.11928146797649, 0.6416119627240985], [101.11934990511703, 0.6416013181462599], [101.11941049785267, 0.6415965092371058], [101.11945089254463, 0.6415929039836255], [101.11951148675298, 0.6415916825708634], [101.11955780866464, 0.6415545858085326], [101.1196219532813, 0.6415210691104019], [101.119669483578, 0.6415330097158369], [101.11974672745885, 0.6415700558272937], [101.11980020968156, 0.6416106993454656], [101.11983348196158, 0.6416214497609117], [101.119932098864, 0.6416273892778086], [101.12000101440384, 0.6416357325497599], [101.12000578158067, 0.641672808890819], [101.1200402504327, 0.6417038912636697], [101.12005805925625, 0.6416715909396087], [101.12012103091611, 0.6416751521542846], [101.12019114203976, 0.6417014369218949], [101.12022561097676, 0.6417349115557219], [101.12020423894455, 0.6417684104024632], [101.12017692541309, 0.6418007155969645], [101.12021258551106, 0.6418413665317373], [101.12024587503346, 0.6418939797873248], [101.12027083876995, 0.641926262250908], [101.12035637500136, 0.6419046979441304], [101.12040746298734, 0.6418998920788956], [101.12042765559526, 0.6418855309531101], [101.12045971314127, 0.6418340874579601], [101.12051911516856, 0.6418232974573963], [101.12055713334259, 0.6418173018219625], [101.12063317322439, 0.6418160739386329], [101.12071040484065, 0.6418256098491456], [101.12074011496749, 0.6418423423997767], [101.12083040200235, 0.6418159915809419], [101.12089336565978, 0.6417980241991981], [101.12093377953563, 0.641841065390296], [101.12097895262372, 0.6418996534126613], [101.12105975761325, 0.6419283250378217], [101.12110252471992, 0.6419151506182448], [101.12122135238687, 0.641950983149666], [101.12131640658005, 0.6419617077273215], [101.12139838496297, 0.6419544975869456], [101.12145660614901, 0.6419616491521911], [101.1215623596442, 0.6419879180682481], [101.12164910659705, 0.642018979449957], [101.12172515539424, 0.6420416732766305], [101.12177267922719, 0.642038065019], [101.12179525067891, 0.6420296826610068], [101.12181780643526, 0.6419854190592094], [101.12187126830605, 0.6419746324329083], [101.12191524134488, 0.642004515548539], [101.12194852847627, 0.6420535403361132], [101.12197467842681, 0.64208103863333], [101.1220055782177, 0.6421013590563829], [101.1220935070265, 0.6421192624703822], [101.12213153404187, 0.6421347953833529], [101.12216838972282, 0.6421933868182187], [101.12221001292257, 0.6422854661383098], [101.12224091823191, 0.6423213353592134], [101.12231933838532, 0.6423296745810435], [101.12250231727806, 0.6423463429897426], [101.12259974829762, 0.6423582626472156], [101.12264845833009, 0.6423498702557632], [101.12269122588212, 0.6423378919559107], [101.12272922927981, 0.642298405531479], [101.1228005034269, 0.6422660819806345], [101.12288722761787, 0.6422421248883134], [101.12298228566871, 0.6422624184529255], [101.12301794416824, 0.6422970886278353], [101.12303577770471, 0.6423269826377587], [101.12313916845221, 0.6423843500566774], [101.1231902528896, 0.6423711721445633], [101.12322113636952, 0.6423520229344015], [101.12326985329473, 0.6423603745629415], [101.1232959894085, 0.6423543829720579], [101.12333994217713, 0.6423352282943853], [101.12338983751016, 0.6423220508811383], [101.12345756026993, 0.6423196302819705], [101.12353599230644, 0.6423590670649019], [101.12360967293799, 0.6423997019618346], [101.12363819869104, 0.6424236117325006], [101.12367150014445, 0.6425073215150878], [101.12368696460562, 0.6425527652934585], [101.12373807224711, 0.6425958018868204], [101.12379630027664, 0.6426196992147898], [101.12385927368618, 0.6426256525957297], [101.12389728395968, 0.6426029120092157], [101.12391865293681, 0.6425622364344601], [101.12393526903016, 0.6425191714938336], [101.12399824193874, 0.6425239296505278], [101.12404456119813, 0.6424808522768282], [101.1241550470812, 0.6424580804484805], [101.12425840318173, 0.6424317241195946], [101.12434157108922, 0.6424281009085716], [101.1244199902432, 0.6424364409855348], [101.12446631442947, 0.6424053240165633], [101.12455185683484, 0.6423993075499022], [101.1245934627281, 0.6424495248738009], [101.12463743818942, 0.6424853885476417], [101.12469803319041, 0.64248655930112], [101.12470038644639, 0.6424327351847924], [101.12475027966471, 0.6424123818928057], [101.12476096216899, 0.6423872595977393], [101.12485600816352, 0.642376455533781], [101.12484056545468, 0.6423836378747575], [101.12486791346242, 0.6424350572880966], [101.1249023733578, 0.6424446109898255], [101.12495227011915, 0.6424350219594144], [101.12502117062802, 0.642407483930221], [101.12502591164665, 0.6423811689018097], [101.1250365792306, 0.6423177731827113], [101.12506269010763, 0.642250782609484], [101.12506148214369, 0.6422029415490275], [101.12509473209246, 0.642159869676684], [101.12511017035146, 0.6421419221744712], [101.12514581309055, 0.6421407111230153], [101.12523372147238, 0.6421095767618417], [101.12529667999303, 0.642079648977297], [101.12533588336686, 0.642068868304735], [101.12537034374203, 0.6420796181377334], [101.12541549254762, 0.6420795992355137], [101.12545826495725, 0.6420795813278374], [101.12550817099668, 0.6420903246919117], [101.12559253453122, 0.6421070342726899], [101.12564837571277, 0.6421058147613294], [101.12571255008793, 0.6421428660816791], [101.12572681645186, 0.642164388621991], [101.12571973521743, 0.6422804088728387], [101.12570669659851, 0.6423545698155799], [101.12570078330121, 0.6424215519040395], [101.12574713117579, 0.6424478455169228], [101.12579465537873, 0.6424454333472729], [101.1258053566617, 0.642465762152258], [101.1258671764118, 0.6425554404951903], [101.12587789698688, 0.6426224147019861], [101.12597176708259, 0.6426415125163886], [101.12602285636572, 0.6426402949734704], [101.12608463811831, 0.6426402690769805], [101.12611792711094, 0.6426916859467722], [101.12615478514887, 0.6427538646679938], [101.12617380934887, 0.6427897387446584], [101.12617500298921, 0.642802894755734], [101.12625818960281, 0.6428447216654416], [101.12636868868289, 0.6428542443565131], [101.12639479455055, 0.6427752934465397], [101.12645655194859, 0.6427142686144105], [101.12655873453262, 0.6427237938924601], [101.12662766020006, 0.642757254775836], [101.12665026581664, 0.6428337929883847], [101.12666929932963, 0.6428899994197621], [101.1267061401348, 0.6429127095001581], [101.12684990837461, 0.6429258056977993], [101.12696041574057, 0.6429532684759813], [101.12704953943668, 0.6429879169880567], [101.1271243957677, 0.642998649826463], [101.12717905266778, 0.6430069988830954], [101.12725865533945, 0.6430021818721232], [101.12731209828497, 0.642948336406289], [101.12732515169644, 0.6429100575517036], [101.12736791465035, 0.6428873140852954], [101.12741305944259, 0.6428777270254352], [101.12744159614046, 0.6429303419586182], [101.12744281256757, 0.6429985162068926], [101.12745471344272, 0.6430463536079961], [101.12749988300118, 0.6430965683953681], [101.12758541483916, 0.6430654349839338], [101.12765074418532, 0.6430223496828987], [101.12771370357703, 0.6429948141326959], [101.12779329145158, 0.6429565073619408], [101.12784438612555, 0.6429684462865424], [101.12787886578315, 0.6430258423114544], [101.12795493712112, 0.6431035541325649], [101.12795615306669, 0.6431705322306072], [101.12791222423941, 0.6432470983044885], [101.12785639998023, 0.6432889834921642], [101.12785998786349, 0.6433451972599655], [101.12790752886058, 0.6433834506562051], [101.12793724286307, 0.6434097511686937], [101.12797050964802, 0.6434097371953789], [101.12803703856704, 0.6433941605000192], [101.12803821783942, 0.6433726315225808], [101.12809525358448, 0.6433869601877308], [101.128123778893, 0.643412065067986], [101.12816299111367, 0.6434228128360108], [101.12819150997666, 0.6434323698724528], [101.1282210603695, 0.6434409744554949]]], [[[101.11928073196829, 0.641545401741355], [101.1192780722621, 0.6414724278230455], [101.1192736309281, 0.6410878205834808], [101.11927403109898, 0.6410825124022032], [101.11927533932334, 0.6410773557324811], [101.11927751884257, 0.6410725060961202], [101.11928050056225, 0.6410681099873078], [101.11928419562514, 0.64106430305923], [101.11928849091598, 0.6410611992765203], [101.1192932571457, 0.6410588936243447], [101.11929834795073, 0.6410574557799851], [101.11930360977216, 0.6410569301087062], [101.1195463412825, 0.6410540759260279], [101.12000959624541, 0.6410562741621337], [101.12057866807429, 0.6410644088899607], [101.12104322516134, 0.6410713910148392], [101.12104331946334, 0.6410713918796057], [101.12153164113863, 0.6410735804167589], [101.12153185399008, 0.6410735785197378], [101.12203655391225, 0.641063804278398], [101.122423551842, 0.6410779827711575], [101.12269673901243, 0.6410934130117737], [101.1226968431954, 0.641093418392901], [101.12269732458559, 0.6410934263288763], [101.1233793061143, 0.6410871618115044], [101.12337951088138, 0.6410871572054554], [101.1237557957738, 0.6410750504943528], [101.12406793589416, 0.6410892573979476], [101.12406808228818, 0.6410892627614252], [101.12435561260453, 0.6410975146418201], [101.12435574013709, 0.6410975173008431], [101.12475970470375, 0.6411033291491913], [101.12476018698543, 0.6411033226189088], [101.12500352374312, 0.6410936618299394], [101.12543102616229, 0.6410982649440957], [101.12543118692366, 0.6410982648768925], [101.12594997125493, 0.6410944632114384], [101.12624658937689, 0.6411206142268487], [101.12624697377781, 0.6411206402850906], [101.12624768777492, 0.6411206436028984], [101.12669314091461, 0.6411049112398696], [101.12723356632675, 0.6410963158803686], [101.12768129470601, 0.6410973237607024], [101.12820401325071, 0.641111815634971], [101.12820703731587, 0.6411121543115302], [101.12820996369355, 0.6411129920933626], [101.12821271154446, 0.641114305507638], [101.12821520541308, 0.6411160593259498], [101.12821737702316, 0.6411182047553612], [101.1282191661769, 0.6411206821503479], [101.12822052255235, 0.6411234237243137], [101.12822140929576, 0.6411263535480871], [101.12822180212466, 0.641129390262682], [101.12822223058465, 0.6411317172421716], [101.12822214633368, 0.6411321313562143], [101.12822203799479, 0.6411329351483488], [101.12822200240552, 0.6411337461428517], [101.12822204046809, 0.6411345742844683], [101.12824300659749, 0.6413580622611285], [101.12824317634093, 0.641768712599527], [101.12822334710407, 0.6420142614818622], [101.12822331777133, 0.6420149983373774], [101.12822335403068, 0.6420158083976795], [101.12822336395175, 0.6420159096529542], [101.12823761054109, 0.6421568305971129], [101.1282216180095, 0.6424738209291023], [101.12822160911938, 0.6424740406296431], [101.12821318736897, 0.6427945872405871], [101.12821318476527, 0.6427948060343919], [101.12821238876586, 0.6431670306359194], [101.1282123924808, 0.6431673262757553], [101.12821926126124, 0.6433841632426479], [101.12817603954336, 0.643372573631392], [101.12814752315977, 0.6433689972283748], [101.1281082985462, 0.643328348092538], [101.12807027253828, 0.643312815314209], [101.1280049263641, 0.6433152350135602], [101.12796453437191, 0.6433248200917763], [101.12795382722777, 0.6432925309595514], [101.12796213468452, 0.6432686067329544], [101.12797637478722, 0.6432267390100567], [101.1279917981302, 0.6431729095182965], [101.1279870255255, 0.643125069143367], [101.12798581255426, 0.6430652669049761], [101.12795965769708, 0.643025808396576], [101.127906175147, 0.642983969102923], [101.12789665472003, 0.6429480910867889], [101.1278621789363, 0.64289787182353], [101.12780632801406, 0.6428775620009868], [101.12775761905014, 0.642885955334261], [101.12771129399786, 0.6429146800264176], [101.12768635903757, 0.642951767731417], [101.12762934467882, 0.6429912611564115], [101.12757351346816, 0.643016402364086], [101.12750104048406, 0.6430224125151224], [101.12748558393756, 0.6429961060015678], [101.12748556214454, 0.642943480009531], [101.12749268042394, 0.6429171631178373], [101.12752712748731, 0.6428980124288061], [101.12753662314933, 0.6428740867956757], [101.12752473565051, 0.6428585430284891], [101.12750452731426, 0.6428346307627787], [101.12745342025292, 0.6427927904485818], [101.12738687933297, 0.6427772696078514], [101.1273429336291, 0.6428131691646851], [101.12732987972093, 0.6428502527945688], [101.12731206857212, 0.6428765732707872], [101.12724436668378, 0.6429268363334097], [101.12717547223161, 0.6429687270045696], [101.12712676027475, 0.6429699435716428], [101.12707210544637, 0.6429687703758558], [101.1270210081801, 0.6429484585422991], [101.12694613748624, 0.6429030397987007], [101.12685227189465, 0.6428947071821742], [101.12674651582456, 0.6428636540178079], [101.1266965998178, 0.6428265976898407], [101.12668708385044, 0.6428014838908116], [101.12666805024917, 0.642742885202457], [101.12663476769497, 0.6427070180215322], [101.1264933515896, 0.6426353132275617], [101.12643633807126, 0.6426748075618887], [101.12639121007346, 0.6427250602637371], [101.12631162616441, 0.642775328319708], [101.12627480821061, 0.6428100296790495], [101.12623678464593, 0.642800476593588], [101.12620469077545, 0.6427658050312911], [101.12619754319394, 0.6427191617219289], [101.1261702070602, 0.642696447641086], [101.12610483162126, 0.6426283002290921], [101.12603471913405, 0.6425960359476133], [101.12595035264148, 0.642572150538058], [101.12589568145368, 0.6425315068753511], [101.12586120566075, 0.6424812875234811], [101.1258314733532, 0.6424107328933633], [101.12578986253874, 0.6423485552352841], [101.12576607072879, 0.6422768019815743], [101.12575773941636, 0.6422409234087935], [101.12576362958033, 0.6421201191436327], [101.12573984568913, 0.6420675030421741], [101.12568162366912, 0.6420579583881977], [101.1256245952805, 0.6420615706534873], [101.12559133299102, 0.6420747410968468], [101.12553191634478, 0.6420496490693097], [101.12551290213385, 0.6420400889003911], [101.12547606873598, 0.642035319804048], [101.12545349190883, 0.6420305447387883], [101.12540478435177, 0.642042525518623], [101.12535249549221, 0.6420162343714457], [101.12531209799272, 0.6420126628941923], [101.12524439458771, 0.642061729828833], [101.12518975048286, 0.6420844782596511], [101.12512677515834, 0.6420737394568481], [101.12509826910588, 0.6420952808172374], [101.12504601226043, 0.6421443412929878], [101.12500089704321, 0.6422256915688801], [101.12498428689335, 0.6422831091289097], [101.124989068843, 0.64235367425383], [101.1249474949952, 0.6423788094819379], [101.12490116588351, 0.642397966054007], [101.12488450779432, 0.6423393653867989], [101.12486073130269, 0.6423046902931204], [101.12481558050202, 0.6422999246788397], [101.12474667948815, 0.6423262665744993], [101.12468847077051, 0.6423490165092214], [101.12465165316421, 0.642382521753274], [101.12463265327199, 0.6424076466284837], [101.12458986008116, 0.6423574298021538], [101.12450906561952, 0.6423538752391603], [101.12438313062691, 0.6423682815238586], [101.12436651107929, 0.6424029735424809], [101.12426432589093, 0.6423874675353162], [101.12421680460508, 0.6423970564713354], [101.12411344553692, 0.642416236017185], [101.12401009288477, 0.6424509652558178], [101.12391861933651, 0.6424809050021428], [101.12388654560912, 0.6424928788299468], [101.12387824650077, 0.642537136419981], [101.1238426239893, 0.6425873861030644], [101.12377489580774, 0.6425766492846138], [101.12371428298175, 0.6425324205405557], [101.12373088475275, 0.6424546705260155], [101.12368453139312, 0.642415219425582], [101.12365956718416, 0.6423817409280865], [101.12355736268923, 0.6423195885197016], [101.12344804381391, 0.6422933211941182], [101.12337674846634, 0.6422742138350881], [101.1232828909816, 0.6422838212471684], [101.1231854803405, 0.6423233325167913], [101.12313676678014, 0.6423209606356185], [101.12309398353004, 0.6422970568170926], [101.12307614999459, 0.6422671628081397], [101.12302860546588, 0.642220537198781], [101.1230000954171, 0.6422325095318163], [101.12293592588124, 0.6422074185214762], [101.12287770425165, 0.6421990708583539], [101.12280641332494, 0.6421907286598993], [101.12273632688307, 0.6422218546750035], [101.12268050237716, 0.6422637408139417], [101.12263892311361, 0.6422781108776272], [101.12251061699368, 0.6423056737577156], [101.12239061354106, 0.6422997432887628], [101.12230030686266, 0.6422782524929671], [101.1222278138895, 0.6422364200040098], [101.12220640785544, 0.6421873911677274], [101.12217310896894, 0.6421120533061478], [101.12211368825884, 0.642077392130858], [101.12203169601192, 0.6420487210462796], [101.12200199083544, 0.6420439489346306], [101.1219722683939, 0.64199731582716], [101.1219401700466, 0.6419518789384797], [101.1218546156612, 0.6419291890858613], [101.12179996558986, 0.6419399762070322], [101.12177383684731, 0.6419639088637394], [101.1217429587561, 0.6419962155267818], [101.12159680382067, 0.641959198309456], [101.12150174274063, 0.6419317287930778], [101.1214245102623, 0.6419221929052333], [101.12125103933356, 0.6419115001821339], [101.12109300777595, 0.6418876453506307], [101.12099913634964, 0.6418637637126937], [101.12095278294886, 0.6418243124992054], [101.12094444927864, 0.6417848463102837], [101.12094562565085, 0.6417561404406585], [101.1209052196633, 0.6417322364652289], [101.12083157443176, 0.6417777166479397], [101.12074009426824, 0.6417921084416223], [101.12065811280688, 0.6417897504071725], [101.12057493821248, 0.6417754324428125], [101.12043949777846, 0.6417910378167736], [101.12039437100337, 0.6418448790347308], [101.12033853702391, 0.6418640395744432], [101.1202720038098, 0.6418700471158758], [101.12025772608982, 0.641821015227818], [101.1202517624183, 0.6417659982974275], [101.12026481292547, 0.6417181511337747], [101.12025529450663, 0.641687057449058], [101.12018042803096, 0.6416524026380017], [101.12007348625893, 0.6416261341422518], [101.11992139166618, 0.6415927076804794], [101.11988575086454, 0.641601094583271], [101.11981801457122, 0.6415688299507025], [101.11975859232703, 0.641530580273167], [101.1196409517939, 0.64149235578213], [101.11957322780243, 0.6414899917649755], [101.11951739387581, 0.6415115436566502], [101.11946988121247, 0.6415402697857794], [101.11941642023935, 0.6415534486560549], [101.11936414393301, 0.6415558618264575], [101.11931899249277, 0.6415499008944449], [101.11928073196829, 0.641545401741355]]]]
  }
}

const stats_request = {
  "input": {
    "bounds": coordinatesBBOX,
    "data": [
      {
        "type": "sentinel-2-l2a"
      }
    ]
  },
  "output": {
    "width": 300,
    "height": 300,
    "responses": [
      {
        "identifier": "default",
        format: { type: "image/png" }
      },
    ],
  },
  "evalscript": evalscript
}

// console.log(stats_request);

const str_evalscript = 'Ly8gVkVSU0lPTj0zCi8vIFF1aWNrRmlyZSBWMS4wLjAgYnkgUGllcnJlIE1hcmt1c2UgKGh0dHBzOi8vdHdpdHRlci5jb20vUGllcnJlX01hcmt1c2UpCi8vIE1hZGUgZm9yIHVzZSBpbiB0aGUgU2VudGluZWwgSHViIEVPIEJyb3dzZXIgKGh0dHBzOi8vYXBwcy5zZW50aW5lbC1odWIuY29tL2VvLWJyb3dzZXIvPykKLy8gQ0MgQlkgNC4wIEludGVybmF0aW9uYWwgKGh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS80LjAvKQoKZnVuY3Rpb24gc2V0dXAoKSB7CiAgcmV0dXJuIHsKICAgIGlucHV0OiBbIkIwMSIsIkIwMiIsIkIwMyIsIkIwNCIsIkIwOCIsIkI4QSIsIkIxMSIsIkIxMiIsIkNMUCIsICJkYXRhTWFzayJdLAogICAgb3V0cHV0OiB7IGJhbmRzOiA0IH0KICB9Owp9CgpmdW5jdGlvbiBzdHJldGNoKHZhbCwgbWluLCBtYXgpIHtyZXR1cm4gKHZhbCAtIG1pbikgLyAobWF4IC0gbWluKTt9IAoKZnVuY3Rpb24gc2F0RW5oKGFyciwgcykgewogICB2YXIgYXZnID0gYXJyLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gYXJyLmxlbmd0aDsKICAgcmV0dXJuIGFyci5tYXAoYSA9PiBhdmcgKiAoMSAtIHMpICsgYSAqIHMpOwp9CgogZnVuY3Rpb24gbGF5ZXJCbGVuZChsYXkxLCBsYXkyLCBsYXkzLCBvcDEsIG9wMiwgb3AzKSB7CiAgICByZXR1cm4gbGF5MS5tYXAoZnVuY3Rpb24obnVtLCBpbmRleCkgewogICAgIHJldHVybiAobnVtIC8gMTAwICogb3AxICsgKGxheTJbaW5kZXhdIC8gMTAwICogb3AyKSArIChsYXkzW2luZGV4XSAvIDEwMCAqIG9wMykpOwogICAgfSk7CiAgfSAgCgpmdW5jdGlvbiBldmFsdWF0ZVBpeGVsKHNhbXBsZSkgewogIGNvbnN0IGhzVGhyZXNob2xkID0gWzIuMCwgMS41LCAxLjI1LCAxLjBdOwogIGNvbnN0IGhvdHNwb3QgPSAxOwogIGNvbnN0IHN0eWxlID0gMTsKICBjb25zdCBoc1NlbnNpdGl2aXR5ID0gMS4wOwogIGNvbnN0IGJvb3N0ID0gMS4yOwogIAogIGNvbnN0IGNsb3VkQXZvaWRhbmNlID0gMTsKICBjb25zdCBjbG91ZEF2b2lkYW5jZVRocmVzaG9sZCA9IDI1NjsKICBjb25zdCBhdm9pZGFuY2VIZWxwZXIgPSAwLjg7CgogIGNvbnN0IG9mZnNldCA9IC0wLjAwNzsKICBjb25zdCBzYXR1cmF0aW9uID0gMS4xMDsKICBjb25zdCBicmlnaHRuZXNzID0gMS40MDsKICBjb25zdCBzTWluID0gMC4xNTsKICBjb25zdCBzTWF4ID0gMC45OTsKICAKICBjb25zdCBzaG93QnVybnNjYXJzID0gMDsKICBjb25zdCBidXJuc2NhclRocmVzaG9sZCA9IC0wLjI1OwogIGNvbnN0IGJ1cm5zY2FyU3RyZW5ndGggPSAwLjM7CgogIGNvbnN0IE5EV0kgPSAoc2FtcGxlLkIwMy1zYW1wbGUuQjA4KS8oc2FtcGxlLkIwMytzYW1wbGUuQjA4KTsKICBjb25zdCBORFZJID0gKHNhbXBsZS5CMDgtc2FtcGxlLkIwNCkvKHNhbXBsZS5CMDgrc2FtcGxlLkIwNCk7CiAgY29uc3Qgd2F0ZXJIaWdobGlnaHQgPSAwOwogIGNvbnN0IHdhdGVyQm9vc3QgPSAyLjA7CiAgY29uc3QgTkRWSV90aHJlc2hvbGQgPSAwLjA1OwogIGNvbnN0IE5EV0lfdGhyZXNob2xkID0gMC4wOwogIGNvbnN0IHdhdGVySGVscGVyID0gMC4xOwogIAogIGNvbnN0IEJsYWNrID0gWzAsIDAsIDBdOwogIGNvbnN0IE5CUmluZGV4ID0gKHNhbXBsZS5CMDgtc2FtcGxlLkIxMikgLyAoc2FtcGxlLkIwOCtzYW1wbGUuQjEyKTsgCiAgY29uc3QgbmF0dXJhbENvbG9yc0NDID0gW01hdGguc3FydChicmlnaHRuZXNzICogc2FtcGxlLkIwNCArIG9mZnNldCksIE1hdGguc3FydChicmlnaHRuZXNzICogc2FtcGxlLkIwMyArIG9mZnNldCksIE1hdGguc3FydChicmlnaHRuZXNzICogc2FtcGxlLkIwMiArIG9mZnNldCldOwogIGNvbnN0IG5hdHVyYWxDb2xvcnMgPSBbKDIuNSAqIGJyaWdodG5lc3MgKiBzYW1wbGUuQjA0ICsgb2Zmc2V0KSwgKDIuNSAqIGJyaWdodG5lc3MgKiBzYW1wbGUuQjAzICsgb2Zmc2V0KSwgKDIuNSAqIGJyaWdodG5lc3MgKiBzYW1wbGUuQjAyICsgb2Zmc2V0KV07CiAgY29uc3QgVVJCQU4gPSBbTWF0aC5zcXJ0KGJyaWdodG5lc3MgKiBzYW1wbGUuQjEyICogMS4yICsgb2Zmc2V0KSwgTWF0aC5zcXJ0KGJyaWdodG5lc3MgKiBzYW1wbGUuQjExICogMS40ICsgb2Zmc2V0KSwgTWF0aC5zcXJ0KGJyaWdodG5lc3MgKiBzYW1wbGUuQjA0ICsgb2Zmc2V0KV07CiAgY29uc3QgU1dJUiA9IFtNYXRoLnNxcnQoYnJpZ2h0bmVzcyAqIHNhbXBsZS5CMTIgKyBvZmZzZXQpLCBNYXRoLnNxcnQoYnJpZ2h0bmVzcyAqIHNhbXBsZS5COEEgKyBvZmZzZXQpLCBNYXRoLnNxcnQoYnJpZ2h0bmVzcyAqIHNhbXBsZS5CMDQgKyBvZmZzZXQpXTsKICBjb25zdCBOSVJibHVlID0gY29sb3JCbGVuZChzYW1wbGUuQjA4LCBbMCwgMC4yNSwgMV0sIFtbMC8yNTUsIDAvMjU1LCAwLzI1NV0sWzAvMjU1LCAxMDAvMjU1LCAxNzUvMjU1XSxbMTUwLzI1NSwgMjMwLzI1NSwgMjU1LzI1NV1dKTsKICBjb25zdCBjbGFzc2ljRmFsc2UgPSBbc2FtcGxlLkIwOCAqIGJyaWdodG5lc3MsIHNhbXBsZS5CMDQgKiBicmlnaHRuZXNzLCBzYW1wbGUuQjAzICogYnJpZ2h0bmVzc107CiAgY29uc3QgTklSID0gW3NhbXBsZS5CMDggKiBicmlnaHRuZXNzLCBzYW1wbGUuQjA4ICogYnJpZ2h0bmVzcywgc2FtcGxlLkIwOCAqIGJyaWdodG5lc3NdOwogIGNvbnN0IGF0bW9QZW4gPSBbc2FtcGxlLkIxMiAqIGJyaWdodG5lc3MsIHNhbXBsZS5CMTEgKiBicmlnaHRuZXNzLCBzYW1wbGUuQjA4ICogYnJpZ2h0bmVzc107CiAgdmFyIGVuaE5hdHVyYWxDb2xvcnMgPSBbMCwgMCwgMF07CiAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpICs9IDEpIHsgZW5oTmF0dXJhbENvbG9yc1tpXSA9IChicmlnaHRuZXNzICogKChuYXR1cmFsQ29sb3JzW2ldICsgbmF0dXJhbENvbG9yc0NDW2ldKSAvIDIpICsgKFVSQkFOW2ldIC8gMTApKTsgfQogIAogIGNvbnN0IG1hbnVhbENvcnJlY3Rpb24gPSBbMC4wNCwgMC4wMCwgLTAuMDVdOwogIAogIHZhciBWaXogPSBsYXllckJsZW5kKFVSQkFOLCBTV0lSLCBuYXR1cmFsQ29sb3JzQ0MsIDEwLCAxMCwgOTApOyAvLyBDaG9vc2UgdmlzdWFsaXphdGlvbihzKSBhbmQgb3BhY2l0eSBoZXJlCgogIGlmICh3YXRlckhpZ2hsaWdodCkgewogICAgaWYgKChORFZJIDwgTkRWSV90aHJlc2hvbGQpICYmIChORFdJID4gTkRXSV90aHJlc2hvbGQpICYmIChzYW1wbGUuQjA0IDwgd2F0ZXJIZWxwZXIpKSB7CiAgICAgVml6WzFdID0gVml6WzFdICogMS4yICogd2F0ZXJCb29zdCArIDAuMTsKICAgICBWaXpbMl0gPSBWaXpbMl0gKiAxLjUgKiB3YXRlckJvb3N0ICsgMC4yOwogICAgfQogIH0gCiAgCiAgVml6ID0gc2F0RW5oKFZpeiwgc2F0dXJhdGlvbik7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpICs9IDEpIHsKICAgIFZpeltpXSA9IHN0cmV0Y2goVml6W2ldLCBzTWluLCBzTWF4KTsgCiAgICBWaXpbaV0gKz0gbWFudWFsQ29ycmVjdGlvbltpXTsgIAogIH0KCiAgaWYgKGhvdHNwb3QpIHsgIAogICAgaWYgKCghY2xvdWRBdm9pZGFuY2UpIHx8ICgoc2FtcGxlLkNMUDxjbG91ZEF2b2lkYW5jZVRocmVzaG9sZCkgJiYgKHNhbXBsZS5CMDI8YXZvaWRhbmNlSGVscGVyKSkpIHsKICAgICBzd2l0Y2ggKHN0eWxlKSB7CiAgICAgICBjYXNlIDE6CiAgICAgICAgaWYgKChzYW1wbGUuQjEyICsgc2FtcGxlLkIxMSkgPiAoaHNUaHJlc2hvbGRbMF0gLyBoc1NlbnNpdGl2aXR5KSkgcmV0dXJuIFsoKGJvb3N0ICogMC41MCAqIHNhbXBsZS5CMTIpK1ZpelswXSksICgoYm9vc3QgKiAwLjUwICogc2FtcGxlLkIxMSkrVml6WzFdKSwgVml6WzJdLCBzYW1wbGUuZGF0YU1hc2tdOyAKICAgICAgICBpZiAoKHNhbXBsZS5CMTIgKyBzYW1wbGUuQjExKSA%2BIChoc1RocmVzaG9sZFsxXSAvIGhzU2Vuc2l0aXZpdHkpKSByZXR1cm4gWygoYm9vc3QgKiAwLjUwICogc2FtcGxlLkIxMikrVml6WzBdKSwgKChib29zdCAqIDAuMjAgKiBzYW1wbGUuQjExKStWaXpbMV0pLCBWaXpbMl0sIHNhbXBsZS5kYXRhTWFza107IAogICAgICAgIGlmICgoc2FtcGxlLkIxMiArIHNhbXBsZS5CMTEpID4gKGhzVGhyZXNob2xkWzJdIC8gaHNTZW5zaXRpdml0eSkpIHJldHVybiBbKChib29zdCAqIDAuNTAgKiBzYW1wbGUuQjEyKStWaXpbMF0pLCAoKGJvb3N0ICogMC4xMCAqIHNhbXBsZS5CMTEpK1ZpelsxXSksIFZpelsyXSwgc2FtcGxlLmRhdGFNYXNrXTsgIAogICAgICAgIGlmICgoc2FtcGxlLkIxMiArIHNhbXBsZS5CMTEpID4gKGhzVGhyZXNob2xkWzNdIC8gaHNTZW5zaXRpdml0eSkpIHJldHVybiBbKChib29zdCAqIDAuNTAgKiBzYW1wbGUuQjEyKStWaXpbMF0pLCAoKGJvb3N0ICogMC4wMCAqIHNhbXBsZS5CMTEpK1ZpelsxXSksIFZpelsyXSwgc2FtcGxlLmRhdGFNYXNrXTsgCiAgICAgICBicmVhazsKICAgICAgIGNhc2UgMjoKICAgICAgICBpZiAoKHNhbXBsZS5CMTIgKyBzYW1wbGUuQjExKSA%2BIChoc1RocmVzaG9sZFszXSAvIGhzU2Vuc2l0aXZpdHkpKSByZXR1cm4gWzEsIDAsIDAsIHNhbXBsZS5kYXRhTWFza107IAogICAgICAgYnJlYWs7CiAgICAgICBjYXNlIDM6CiAgICAgICAgaWYgKChzYW1wbGUuQjEyICsgc2FtcGxlLkIxMSkgPiAoaHNUaHJlc2hvbGRbM10gLyBoc1NlbnNpdGl2aXR5KSkgcmV0dXJuIFsxLCAxLCAwLCBzYW1wbGUuZGF0YU1hc2tdOyAKICAgICAgIGJyZWFrOwogICAgICAgY2FzZSA0OiAgCiAgICAgICAgaWYgKChzYW1wbGUuQjEyICsgc2FtcGxlLkIxMSkgPiAoaHNUaHJlc2hvbGRbM10gLyBoc1NlbnNpdGl2aXR5KSkgcmV0dXJuIFtWaXpbMF0gKyAwLjIsIFZpelsxXSAtIDAuMiwgVml6WzJdIC0gMC4yLCBzYW1wbGUuZGF0YU1hc2tdOwogICAgICAgYnJlYWs7CiAgICAgICBkZWZhdWx0OgogICAgICB9CiAgICB9CiAgfQoKICBpZiAoc2hvd0J1cm5zY2FycykgewogICBpZiAoTkJSaW5kZXg8YnVybnNjYXJUaHJlc2hvbGQpIHsKICAgICBWaXpbMF0gPSBWaXpbMF0gKyBidXJuc2NhclN0cmVuZ3RoOwogICAgIFZpelsxXSA9IFZpelsxXSArIGJ1cm5zY2FyU3RyZW5ndGg7CiAgIH0KICB9CgogIHJldHVybiBbVml6WzBdLCBWaXpbMV0sIFZpelsyXSwgc2FtcGxlLmRhdGFNYXNrXTsKfQ%3D%3D';

const API_URL = "https://services.sentinel-hub.com/api/v1/process";
// const API_URL = `https://services.sentinel-hub.com/ogc/wms/${instanceID}?REQUEST=GetMap&BBOX=200,400,300,600&MAXCC=0&LAYERS=NATURAL-COLOR&EVALSCRIPT=${str_evalscript}&QUALITY=100&WIDTH=500&HEIGHT=500&FORMAT=image/jpeg&TIME=2018-08-05`;

// Set up request parameters
const requestParams = {
  method: "POST",
  headers: {
    Accept: "*/*",
    "Content-Type": "application/json",
    Authorization: `Bearer ${token}`
  },
  body: JSON.stringify(stats_request)
}

// Make the request
fetch(API_URL, requestParams)
.then((response) => response.blob())
.then((blob) => {
  const url = window.URL.createObjectURL(blob)
  document.getElementById("image").src = url
})
.catch((error) => console.error('Error:', error))
